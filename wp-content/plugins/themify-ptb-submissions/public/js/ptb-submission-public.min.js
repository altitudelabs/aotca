(function(d){var k={},i={};var l=function(){d(document).on("click",".ptb_language_tabs li",function(v){v.preventDefault();if(!d(this).hasClass("ptb_active_tab_lng")){var u=d(this).closest("ul");var t=u.next("ul");u.find(".ptb_active_tab_lng").removeClass("ptb_active_tab_lng");d(this).addClass("ptb_active_tab_lng");t.find(".ptb_active_lng").removeClass("ptb_active_lng");t.find("li").eq(d(this).index()).addClass("ptb_active_lng")}})};function e(t){var v=["n/a","B","KB","MB"];var u=+Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,u)).toFixed(u?1:0)+" "+v[isNaN(t)?0:u+1]}var g=function(t){t.each(function(){var x=d(this).closest(".ptb-submission-text-option");x=x.length>0?x:d(this).closest(".ptb_module");var v=d(this).closest("form"),y=d(this).data("extension")?new RegExp("(\\.|/)("+d(this).data("extension")+")$","i"):/(\.|\/)(gif|jpe?g|png)$/i,B=d(this).data("size"),u=d(this).data("width"),w=d(this).data("height"),z=x.find(".ptb-submission-priview"),A=d(this);d(this).fileupload({url:v.attr("action"),type:"POST",acceptFileTypes:y,maxFileSize:B,dataType:"json",singleFileUploads:true,autoUpload:false,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:u?u:100,previewMaxHeight:w?w:100,previewCrop:true}).on("fileuploadprocessalways",function(I,H){var C=H.index,E=H.files[C],G=d('.ptb-submission-upload-btn[for="'+A.attr("id")+'"]');z.next(".ptb-submission-file-danger").remove();z.hide("blind",500,function(){if(E.error){G.html(A.data("label"));d(this).after(d('<span class="ptb-submission-file-danger ptb-submission-error-text"/>').text(E.error))}else{if(E.preview){d(this).html(E.preview);if(d(this).closest(".ptb-submission-multi-text").length===0&&d(this).closest(".ptb-submission-module-req").length===0){d(this).append('<span data-slug="'+A.attr("id")+'" class="fa fa-minus-circle ptb-submission-file-remove"></span>')}d(this).append('<span class="ptb-submission-file-name">'+E.name+"</span>").append('<span class="ptb-submission-file-size">'+e(E.size)+"</span>").width(H.previewMaxWidth).show("blind",500)}else{d(this).html("")}var J=E.name.length>12?E.name.substring(0,12)+"...":E.name;G.html("<span>"+J+"</span>")}});if(!E.error){for(var D=0;D<H.files.length;D++){var F=d(this).attr("id");k[F]=H.files[D];i[F]=I.delegateTarget.name}}})})};var j=function(){d(".ptb_module").delegate(".ptb-submission-file-remove","click",function(u){u.preventDefault();var t=d(this).closest(".ptb-submission-priview");var w=t.find(".ptb-submission-file-wrap"),v=d(this).data("slug");r(w,v,t)})};var r=function(w,u,v){v.hide("blind",500,function(){d(this).empty()});delete i[u];delete k[u];w.html(w.html());var t=d('.ptb-submission-upload-btn[for="'+u+'"');t.html(t.data("label"));g(w.find(".ptb-submission-file"))};var s=function(){var t=d(".ptb-submission-autocomplete");var u=[];t.each(function(){var x=d(this).data("slug"),w=d(this),v=d(this).data("post_type");u[x]={};d(this).autocomplete({minLength:2,source:function(A,y){var z=A.term;if(z in u[x]){y(u[x][z]);return}d.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{term:A.term,slug:x,post_type:v,action:"ptb_submission_terms"},success:function(B){u[x][z]=B;y(B)}})},focus:function(y,z){y.preventDefault()},open:function(){d("ul.ui-menu").width(d(this).innerWidth())},select:function(y,z){w.val(z.item.label);w.next("input").val(z.item.value);return false}})})};var o=function(){function u(x){return x.split(/,\s*/)}function w(x){return u(x).pop()}var t=d(".ptb_post_tag");if(t.length>0){var v=[];t.each(function(){var y=d(this).find('input[type="text"]'),x=d(this).closest("form").children('input[name="post_type"]').val(),z=/.*?\[.*?\]\[(.+?)\]$/;y.each(function(){var A=d(this),B=A.prop("name").match(z);if(B.length===0||!B[1]){return false}B=B[1];v[B]={};d(this).autocomplete({minLength:2,source:function(E,C){var D=E.term;if(D in v[B]){C(v[B][D]);return}d.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{term:w(E.term),slug:B,post_type:x,action:"ptb_submission_tag_terms"},success:function(F){v[B][D]=F;C(F)}})},focus:function(C,D){C.preventDefault()},open:function(){d("ul.ui-menu").width(d(this).innerWidth())},select:function(E,F){var D=u(this.value);if(d.inArray(F.item.label,D)===-1){D.pop();D.push(F.item.label);D.push("");this.value=D.join(", ");console.log(D)}else{var C=D.indexOf(w(this.value));D[C]=null;this.value=D.join(", ")}return false}})})})}};var h=function(){var u=d(".ptb-submission-text-option input,.ptb-submission-text-option textarea");u.each(function(){var v=d(this).attr("name");if(v){d(this).attr("name",v+"[]")}});var t=d(".ptb-submission-multi-text li");t.each(function(){if(d(this).find(".ptb-submission-priview").length>0){var v=q();d(this).find("label").prop("for",v);d(this).find('input[type="file"]').prop("id",v)}});t=u=null;d("body").delegate(".ptb-submission-option-add","click",function(y){y.preventDefault();y.stopPropagation();var C=d(this).closest(".ptb-submission-multi-text"),w=C.data("max"),B=C.find(".ptb-submission-text-option").length;if(w&&B>=w){return}var z=C.find(".ptb-submission-text-option").first().clone(),x=C.children("ul");z.find("input,textarea").val("");z.find(".ptb-submission-required-error").removeClass("ptb-submission-required-error");var v=z.find(".ptb-submission-priview");d.event.trigger("ptb_submission_before_option_add",z);if(v.length>0){var D=q();z.find(".ptb-submission-error-text").remove();var A=z.find("label");A.prop("for",D);A.html(A.data("label"));z.find('input[type="file"]').prop("id",D);v.empty().hide()}z.appendTo(x).hide().show("blind",500);if(v.length>0){g(d("#"+D))}d.event.trigger("ptb_submission_after_option_add",z);x.sortable("refresh");if(w&&(B+1)>=w){d(this).fadeOut()}});d("body").delegate(".ptb-submission-remove","click",function(z){z.preventDefault();z.stopPropagation();var y=d(this).closest(".ptb-submission-text-option"),x=y.find(".ptb-submission-priview");if(x.length>0){var C=x.closest(".ptb-submission-text-option").find(".ptb-submission-file-wrap"),B=C.find("input").attr("id");r(C,B,x);if(y.closest("ul").children("li").length==1){y.find("input").val("");return false}}var w=d(this).closest(".ptb-submission-multi-text"),v=w.data("max"),A=w.find(".ptb-submission-text-option").length;if(v&&(A-1)<v){w.find(".ptb-submission-option-add").fadeIn()}y.hide("blind",500,function(){d(this).remove()})});n()};var q=function(){return"ptb_submission_"+Math.random().toString(36).substr(2,9)};var p=function(){d(".ptb-select").chosen({disable_search_threshold:7,search_contains:true,width:"100%"})};var a=function(){d(".ptb-submission-captcha-refresh").click(function(v){v.preventDefault();var t=d(this).closest("form");t.addClass("ptb-submission-wait");var u=d(this).closest("table").find("img");u.attr("src",u.attr("src")).load(function(){t.removeClass("ptb-submission-wait")})})};var m=function(){d(".ptb-submission-form").on("submit",function(y){y.preventDefault();var D=d(this);var v=true;var u=D.find(".ptb-submission-module-req"),z=D.find(".ptb-submission-form-error");D.find(".ptb-submission-required-error,.ptb-submission-label-required").removeClass("ptb-submission-required-error ptb-submission-label-required");D.find(".switch-html").trigger("click");u.each(function(){var E=d(this);var F=E.find("input,select,textarea");F.each(function(){var I=false,J=d(this).attr("name");if(!J){return false}if(d(this).is(":checkbox")||d(this).is(":radio")){if(E.find('[name^="'+J+'"]:checked').length>0){return false}I=true}else{if(!d.trim(d(this).val())&&d(this).closest(".chosen-container").length==0){if(d.trim(d(this).closest(".ptb_module").find(".ptb-submission-priview").html())){return false}I=true}}var G=d(this).closest(".ptb_module").data("type");var H=d.event.trigger("ptb_submission_validate_"+G,[d(this),k]);if(typeof H!=="undefined"){I=H}if(I){d(this).addClass("ptb-submission-required-error");E.addClass("ptb-submission-label-required");v=false}})});if(v){z.html("");if(Object.keys(k).length>0){var B=[],C=[];var x=d(".ptb-submission-multi-text");if(x.length>0){var A=x.find(">ul>li");A.each(function(){var F=d(this).find("input,textarea");var E=d(this).index();F.each(function(){var G=d(this).attr("name");if(G){G=G.replace(/\[[0-9]*\]/i,"["+E+"]");d(this).attr("name",G)}})})}for(var t in k){if(d("#"+t).closest(".ptb-submission-multi-text").length>0){var w=d("#"+t).closest("li").index();i[t]=i[t].replace(/\[[0-9]*\]/i,"["+w+"]")}C.push(i[t]);B.push(k[t])}D.addClass("ptb-submission-wait");d(".ptb-submission-file",D).fileupload("send",{files:B,paramName:C}).complete(function(){D.removeClass("ptb-submission-wait")}).success(function(E){c(E,D)})}else{d.ajax({url:D.attr("action"),type:"POST",dataType:"json",data:D.serialize(),beforeSend:function(){D.addClass("ptb-submission-wait")},complete:function(){D.removeClass("ptb-submission-wait")},success:function(E){c(E,D)}})}}else{z.html(ptb_submission.errors)}})};var c=function(t,C){var u=C.find(".ptb-submission-errors"),w=C.find(".ptb-submission-form-error");u.html("");C.find(".ptb-submission-error-text").remove();if(t){if(t.success){if(t.r){window.location.href=t.success}else{var B=window.location.search?window.location.href+"&":window.location.href+"?";B+="nonce="+t.nonce+"&form_id="+t.form_id;window.location.href=B}}else{if(t.fee){window.location.href=t.fee}else{for(var A in t){if(A=="captcha"){C.find(".ptb-submission-captcha-refresh").trigger("click")}if(typeof t[A]!=="object"){var v=t[A];t[A]=[];t[A][0]=1}for(var z in t[A]){var x=C.find('[name^="submission['+A+']"]'),y=z!=0?t[A][z]:v;if(x.length==0){x=C.find('[name^="'+A+'"]')}if(x.length>0){x.addClass("ptb-submission-required-error");x.closest(".ptb_module").addClass("ptb-submission-label-required");x.first().closest(".ptb_back_active_module_input").append('<div class="ptb-submission-error-text">'+y+"</div>")}else{u.append("<div>"+y+"</div>")}}}w.html(ptb_submission.errors)}}}};var n=function(){d(".ptb-submission-multi-text>ul").sortable({placeholder:"ui-state-highlight"})};var f=function(){d(".ptb_number input").on("focusout",function(){var v=parseFloat(d(this).prop("min")),u=parseFloat(d(this).prop("max")),t=parseFloat(d(this).val());if(t<v){d(this).val(v)}else{if(t>u){d(this).val(u)}}if(d(this).hasClass("ptb_number_min")){u=parseFloat(d(this).closest(".ptb_module").find(".ptb_number_max").val());if(u<=t){d(this).val(u-1)}}else{if(d(this).hasClass("ptb_number_max")){v=parseFloat(d(this).closest(".ptb_module").find(".ptb_number_min").val());if(v>=t){d(this).val(v+1)}}}})};var b=function(){d("form.add_temp_tax").submit(function(w){w.preventDefault();var v=d(this),x=v.find('input[type="text"]'),t=false,u=d(this).find(".ptb_language_tabs").length>0;v.find(".ptb-submission-error-text").remove();v.find(".ptb-submission-required-error").removeClass("ptb-submission-required-error");x.each(function(){if(!d.trim(d(this).val())){if(u){var y=d(this).closest(".ptb_back_active_module_input");if(y.find(".ptb-submission-error-text").length===0){y.append('<span class="ptb-submission-error-text">'+ptb_submission.tax_all_errors+"<span>")}}t=true;d(this).attr("placeholder",ptb_submission.tax_error).addClass("ptb-submission-required-error");d(this).addClass("ptb-submission-required-error")}});if(t){return false}d.ajax({url:v.prop("action"),data:v.serialize(),type:"POST",dataType:"json",beforeSend:function(){v.addClass("ptb-submission-wait")},complete:function(){v.removeClass("ptb-submission-wait");d("#lightcase-overlay").trigger("click")},success:function(B){if(B&&B.slug){var z=d("a#ptb_submission_lightbox_"+B.slug),I=z.closest(".ptb_back_active_module_input"),M=I.find("select").length>0,A=!M&&(I.find("input:radio").length>0||I.find("input:checkbox").length>0),O=!M&&!A&&I.find(".ptb-submission-autocomplete").length>0;if(B.exists){for(var L in B.exists){if(M){var C=I.find("select");if(!C.prop("multiple")){C.find("option:selected").prop("selected",false)}C.find('option[value="'+L+'"]').prop("selected",true)}else{if(A){I.find("#ptb_tax_"+L).prop("checked",true)}else{if(O){I.find('input[type="text"]').val(B.exists[L].title);I.find('input[type="text"]').next("input").val(L)}}}}}if(B.add){var E=d.unique(B.add[B.lng]);var D=A?(I.find("input:radio").length>0?"radio":"checkbox"):false;for(var L in E){if(M){var N=I.find('option[value="'+E[L].slug+'"]');if(!I.find("select").prop("multiple")){I.find("option").removeAttr("selected")}if(N.length>0){N.prop("selected",true)}else{I.find("select").prepend('<option value="'+E[L].slug+'" selected="selected">'+E[L].value+"</option>")}}else{if(A){if(D==="radio"){I.find("input").prop("checked",false)}var N=I.find('input[value="'+E[L].slug+'"]');if(N.length>0){N.find("input").prop("checked","checked")}else{I.prepend('<label class="ptb-submission-new-item"><input name="'+I.find("input[name]").first().prop("name")+'" value="'+E[L].slug+'" type="'+D+'" checked="checked" /><span>'+E[L].value+"</span></label>")}}else{if(O){I.find('input[type="text"]').val(E[L].value)}}}}var H={};for(var G in B.add){H[G]=[];for(var F in B.add[G]){H[G].push(B.add[G][F].value)}}var y=z.next("input"),J=y.val(),J=J?JSON.parse(window.atob(J)):[];for(var L in J){for(var K in J[L]){H[L].push(J[L][K])}}y.val(window.btoa(JSON.stringify(H)))}if(M){I.find("select").trigger("chosen:updated").next(".chosen-container").find("a,ul").effect("highlight",{},2000)}else{d(".ptb-submission-new-item").effect("highlight",{},2000).removeClass("ptb-submission-new-item")}}}})})};d(document).on("ptb_loaded",function(){if(d(".ptb_is_single_lightbox .ptb_lightbox_add_tax").length>0){var t=d(".ptb_is_single_lightbox").removeClass("ptb_is_single_lightbox").addClass("ptb_lightbox_add_tax_wrapper").find('input[type="text"]');t.each(function(){var u=d(this).attr("name");if(u){d(this).attr("name",u+"[]")}});n();b()}});d(document).ready(function(){l();g(d('input[type="file"].ptb-submission-file'));j();s();o();p();h();a();f();m();d("form.ptb-submission-form").each(function(){var t=d(this).find(".ptb-submission-priview");t.each(function(){if(d(this).children("*").length>0){d(this).show()}})})})}(jQuery));