!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],a):"object"==typeof exports?a(require("jquery"),require("./vendor/jquery.ui.widget")):a(window.jQuery)}(function(b){function a(d){var c="dragover"===d;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var f=e.dataTransfer;f&&-1!==b.inArray("Files",f.types)&&this._trigger(d,b.Event(d,{delegatedEvent:e}))!==!1&&(e.preventDefault(),c&&(f.dropEffect="copy"))}}b.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||b('<input type="file">').prop("disabled")),b.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),b.support.xhrFormDataFileUpload=!!window.FormData,b.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),b.widget("blueimp.fileupload",{options:{dropZone:b(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(d,c){return d=this.messages[d]||d.toString(),c&&b.each(c,function(g,f){d=d.replace("{"+g+"}",f)}),d},formData:function(c){return c.serializeArray()},add:function(d,c){return d.isDefaultPrevented()?!1:void ((c.autoUpload||c.autoUpload!==!1&&b(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:b.support.blobSlice&&function(){var c=this.slice||this.webkitSlice||this.mozSlice;return c.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(g,d,c){var f=g-this.timestamp;return(!this.bitrate||!c||f>c)&&(this.bitrate=(d-this.loaded)*(1000/f)*8,this.loaded=d,this.timestamp=g),this.bitrate}},_isXHRUpload:function(c){return !c.forceIframeTransport&&(!c.multipart&&b.support.xhrFileUpload||b.support.xhrFormDataFileUpload)},_getFormData:function(d){var c;return"function"===b.type(d.formData)?d.formData(d.form):b.isArray(d.formData)?d.formData:"object"===b.type(d.formData)?(c=[],b.each(d.formData,function(g,f){c.push({name:g,value:f})}),c):[]},_getTotal:function(d){var c=0;return b.each(d,function(g,f){c+=f.size||1}),c},_initProgressObject:function(d){var c={loaded:0,total:0,bitrate:0};d._progress?b.extend(d._progress,c):d._progress=c},_initResponseObject:function(d){var c;if(d._response){for(c in d._response){d._response.hasOwnProperty(c)&&delete d._response[c]}}else{d._response={}}},_onProgress:function(d,c){if(d.lengthComputable){var e,f=Date.now?Date.now():(new Date).getTime();if(c._time&&c.progressInterval&&f-c._time<c.progressInterval&&d.loaded!==d.total){return}c._time=f,e=Math.floor(d.loaded/d.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0),this._progress.loaded+=e-c._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(f,this._progress.loaded,c.bitrateInterval),c._progress.loaded=c.loaded=e,c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(f,e,c.bitrateInterval),this._trigger("progress",b.Event("progress",{delegatedEvent:d}),c),this._trigger("progressall",b.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(d){var c=this,e=d.xhr?d.xhr():b.ajaxSettings.xhr();e.upload&&(b(e.upload).bind("progress",function(g){var f=g.originalEvent;g.lengthComputable=f.lengthComputable,g.loaded=f.loaded,g.total=f.total,c._onProgress(g,d)}),d.xhr=function(){return e})},_isInstanceOf:function(d,c){return Object.prototype.toString.call(c)==="[object "+d+"]"},_initXHRData:function(d){var c,f=this,h=d.files[0],g=d.multipart||!b.support.xhrFileUpload,e="array"===b.type(d.paramName)?d.paramName[0]:d.paramName;d.headers=b.extend({},d.headers),d.contentRange&&(d.headers["Content-Range"]=d.contentRange),g&&!d.blob&&this._isInstanceOf("File",h)||(d.headers["Content-Disposition"]='attachment; filename="'+encodeURI(h.name)+'"'),g?b.support.xhrFormDataFileUpload&&(d.postMessage?(c=this._getFormData(d),d.blob?c.push({name:e,value:d.blob}):b.each(d.files,function(i,j){c.push({name:"array"===b.type(d.paramName)&&d.paramName[i]||e,value:j})})):(f._isInstanceOf("FormData",d.formData)?c=d.formData:(c=new FormData,b.each(this._getFormData(d),function(j,i){c.append(i.name,i.value)})),d.blob?c.append(e,d.blob,h.name):b.each(d.files,function(j,i){(f._isInstanceOf("File",i)||f._isInstanceOf("Blob",i))&&c.append("array"===b.type(d.paramName)&&d.paramName[j]||e,i,i.uploadName||i.name)})),d.data=c):(d.contentType=h.type||"application/octet-stream",d.data=d.blob||h),d.blob=null},_initIframeSettings:function(d){var c=b("<a></a>").prop("href",d.url).prop("host");d.dataType="iframe "+(d.dataType||""),d.formData=this._getFormData(d),d.redirect&&c&&c!==location.host&&d.formData.push({name:d.redirectParamName||"redirect",value:d.redirect})},_initDataSettings:function(c){this._isXHRUpload(c)?(this._chunkedUpload(c,!0)||(c.data||this._initXHRData(c),this._initProgressListener(c)),c.postMessage&&(c.dataType="postmessage "+(c.dataType||""))):this._initIframeSettings(c)},_getParamName:function(d){var c=b(d.fileInput),e=d.paramName;return e?b.isArray(e)||(e=[e]):(e=[],c.each(function(){for(var g=b(this),f=g.prop("name")||"files[]",h=(g.prop("files")||[1]).length;h;){e.push(f),h-=1}}),e.length||(e=[c.prop("name")||"files[]"])),e},_initFormSettings:function(c){c.form&&c.form.length||(c.form=b(c.fileInput.prop("form")),c.form.length||(c.form=b(this.options.fileInput.prop("form")))),c.paramName=this._getParamName(c),c.url||(c.url=c.form.prop("action")||location.href),c.type=(c.type||"string"===b.type(c.form.prop("method"))&&c.form.prop("method")||"").toUpperCase(),"POST"!==c.type&&"PUT"!==c.type&&"PATCH"!==c.type&&(c.type="POST"),c.formAcceptCharset||(c.formAcceptCharset=c.form.attr("accept-charset"))},_getAJAXSettings:function(d){var c=b.extend({},this.options,d);return this._initFormSettings(c),this._initDataSettings(c),c},_getDeferredState:function(c){return c.state?c.state():c.isResolved()?"resolved":c.isRejected()?"rejected":"pending"},_enhancePromise:function(c){return c.success=c.done,c.error=c.fail,c.complete=c.always,c},_getXHRPromise:function(d,c,e){var g=b.Deferred(),f=g.promise();return c=c||this.options.context||f,d===!0?g.resolveWith(c,e):d===!1&&g.rejectWith(c,e),f.abort=g.promise,this._enhancePromise(f)},_addConvenienceMethods:function(d,c){var e=this,f=function(g){return b.Deferred().resolveWith(e,g).promise()};c.process=function(g,h){return(g||h)&&(c._processQueue=this._processQueue=(this._processQueue||f([this])).pipe(function(){return c.errorThrown?b.Deferred().rejectWith(e,[c]).promise():f(arguments)}).pipe(g,h)),this._processQueue||f([this])},c.submit=function(){return"pending"!==this.state()&&(c.jqXHR=this.jqXHR=e._trigger("submit",b.Event("submit",{delegatedEvent:d}),this)!==!1&&e._onSend(d,this)),this.jqXHR||e._getXHRPromise()},c.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",e._trigger("fail",null,this),e._getXHRPromise(!1))},c.state=function(){return this.jqXHR?e._getDeferredState(this.jqXHR):this._processQueue?e._getDeferredState(this._processQueue):void 0},c.processing=function(){return !this.jqXHR&&this._processQueue&&"pending"===e._getDeferredState(this._processQueue)},c.progress=function(){return this._progress},c.response=function(){return this._response}},_getUploadedBytes:function(g){var d=g.getResponseHeader("Range"),c=d&&d.split("-"),f=c&&c.length>1&&parseInt(c[1],10);return f&&f+1},_chunkedUpload:function(x,k){x.uploadedBytes=x.uploadedBytes||0;var c,g,f=this,y=x.files[0],v=y.size,j=x.uploadedBytes,e=x.maxChunkSize||v,w=this._blobSlice,q=b.Deferred(),m=q.promise();return this._isXHRUpload(x)&&w&&(j||v>e)&&!x.data?k?!0:j>=v?(y.error=x.i18n("uploadedBytes"),this._getXHRPromise(!1,x.context,[null,"error",y.error])):(g=function(){var d=b.extend({},x),l=d._progress.loaded;d.blob=w.call(y,j,j+e,y.type),d.chunkSize=d.blob.size,d.contentRange="bytes "+j+"-"+(j+d.chunkSize-1)+"/"+v,f._initXHRData(d),f._initProgressListener(d),c=(f._trigger("chunksend",null,d)!==!1&&b.ajax(d)||f._getXHRPromise(!1,d.context)).done(function(i,h,n){j=f._getUploadedBytes(n)||j+d.chunkSize,l+d.chunkSize-d._progress.loaded&&f._onProgress(b.Event("progress",{lengthComputable:!0,loaded:j-d.uploadedBytes,total:j-d.uploadedBytes}),d),x.uploadedBytes=d.uploadedBytes=j,d.result=i,d.textStatus=h,d.jqXHR=n,f._trigger("chunkdone",null,d),f._trigger("chunkalways",null,d),v>j?g():q.resolveWith(d.context,[i,h,n])}).fail(function(n,h,i){d.jqXHR=n,d.textStatus=h,d.errorThrown=i,f._trigger("chunkfail",null,d),f._trigger("chunkalways",null,d),q.rejectWith(d.context,[n,h,i])})},this._enhancePromise(m),m.abort=function(){return c.abort()},g(),m):!1},_beforeSend:function(d,c){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(c),this._initProgressObject(c),c._progress.loaded=c.loaded=c.uploadedBytes||0,c._progress.total=c.total=this._getTotal(c.files)||1,c._progress.bitrate=c.bitrate=0,this._active+=1,this._progress.loaded+=c.loaded,this._progress.total+=c.total},_onDone:function(d,c,f,h){var g=h._progress.total,e=h._response;h._progress.loaded<g&&this._onProgress(b.Event("progress",{lengthComputable:!0,loaded:g,total:g}),h),e.result=h.result=d,e.textStatus=h.textStatus=c,e.jqXHR=h.jqXHR=f,this._trigger("done",null,h)},_onFail:function(g,d,c,f){var h=f._response;f.recalculateProgress&&(this._progress.loaded-=f._progress.loaded,this._progress.total-=f._progress.total),h.jqXHR=f.jqXHR=g,h.textStatus=f.textStatus=d,h.errorThrown=f.errorThrown=c,this._trigger("fail",null,f)},_onAlways:function(g,d,c,f){this._trigger("always",null,f)},_onSend:function(k,h){h.submit||this._addConvenienceMethods(k,h);var c,f,e,m,j=this,g=j._getAJAXSettings(h),d=function(){return j._sending+=1,g._bitrateTimer=new j._BitrateTimer,c=c||((f||j._trigger("send",b.Event("send",{delegatedEvent:k}),g)===!1)&&j._getXHRPromise(!1,g.context,f)||j._chunkedUpload(g)||b.ajax(g)).done(function(o,n,l){j._onDone(o,n,l,g)}).fail(function(o,n,l){j._onFail(o,n,l,g)}).always(function(p,n,l){if(j._onAlways(p,n,l,g),j._sending-=1,j._active-=1,g.limitConcurrentUploads&&g.limitConcurrentUploads>j._sending){for(var o=j._slots.shift();o;){if("pending"===j._getDeferredState(o)){o.resolve();break}o=j._slots.shift()}}0===j._active&&j._trigger("stop")})};return this._beforeSend(k,g),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(e=b.Deferred(),this._slots.push(e),m=e.pipe(d)):(this._sequence=this._sequence.pipe(d,d),m=this._sequence),m.abort=function(){return f=[void 0,"abort","abort"],c?c.abort():(e&&e.rejectWith(g.context,f),d())},this._enhancePromise(m)):d()},_onAdd:function(G,x){var e,q,k,H,D=this,w=!0,j=b.extend({},this.options,x),F=x.files,B=F.length,y=j.limitMultiFileUploads,C=j.limitMultiFileUploadSize,A=j.limitMultiFileUploadSizeOverhead,z=0,E=this._getParamName(j),v=0;if(!B){return !1}if(C&&void 0===F[0].size&&(C=void 0),(j.singleFileUploads||y||C)&&this._isXHRUpload(j)){if(j.singleFileUploads||C||!y){if(!j.singleFileUploads&&C){for(k=[],e=[],H=0;B>H;H+=1){z+=F[H].size+A,(H+1===B||z+F[H+1].size+A>C||y&&H+1-v>=y)&&(k.push(F.slice(v,H+1)),q=E.slice(v,H+1),q.length||(q=E),e.push(q),v=H+1,z=0)}}else{e=E}}else{for(k=[],e=[],H=0;B>H;H+=y){k.push(F.slice(H,H+y)),q=E.slice(H,H+y),q.length||(q=E),e.push(q)}}}else{k=[F],e=[E]}return x.originalFiles=F,b.each(k||F,function(f,c){var d=b.extend({},x);return d.files=k?c:[c],d.paramName=e[f],D._initResponseObject(d),D._initProgressObject(d),D._addConvenienceMethods(G,d),w=D._trigger("add",b.Event("add",{delegatedEvent:G}),d)}),w},_replaceFileInput:function(d){var c=d.fileInput,e=c.clone(!0);d.fileInputClone=e,b("<form></form>").append(e)[0].reset(),c.after(e).detach(),b.cleanData(c.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(g,f){return f===c[0]?e[0]:f}),c[0]===this.element[0]&&(this.element=e)},_handleFileTreeEntry:function(k,h){var c,f=this,e=b.Deferred(),m=function(i){i&&!i.entry&&(i.entry=k),e.resolve([i])},j=function(i){f._handleFileTreeEntries(i,h+k.name+"/").done(function(l){e.resolve(l)}).fail(m)},g=function(){c.readEntries(function(i){i.length?(d=d.concat(i),g()):j(d)},m)},d=[];return h=h||"",k.isFile?k._file?(k._file.relativePath=h,e.resolve(k._file)):k.file(function(i){i.relativePath=h,e.resolve(i)},m):k.isDirectory?(c=k.createReader(),g()):e.resolve([]),e.promise()},_handleFileTreeEntries:function(d,c){var e=this;return b.when.apply(b,b.map(d,function(f){return e._handleFileTreeEntry(f,c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(d){d=d||{};var c=d.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(b.map(c,function(g){var f;return g.webkitGetAsEntry?(f=g.webkitGetAsEntry(),f&&(f._file=g.getAsFile()),f):g.getAsEntry()})):b.Deferred().resolve(b.makeArray(d.files)).promise()},_getSingleFileInputFiles:function(d){d=b(d);var c,e,f=d.prop("webkitEntries")||d.prop("entries");if(f&&f.length){return this._handleFileTreeEntries(f)}if(c=b.makeArray(d.prop("files")),c.length){void 0===c[0].name&&c[0].fileName&&b.each(c,function(h,g){g.name=g.fileName,g.size=g.fileSize})}else{if(e=d.prop("value"),!e){return b.Deferred().resolve([]).promise()}c=[{name:e.replace(/^.*\\/,"")}]}return b.Deferred().resolve(c).promise()},_getFileInputFiles:function(c){return c instanceof b&&1!==c.length?b.when.apply(b,b.map(c,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(c)},_onChange:function(d){var c=this,e={fileInput:b(d.target),form:b(d.target.form)};this._getFileInputFiles(e.fileInput).always(function(f){e.files=f,c.options.replaceFileInput&&c._replaceFileInput(e),c._trigger("change",b.Event("change",{delegatedEvent:d}),e)!==!1&&c._onAdd(d,e)})},_onPaste:function(d){var c=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,e={files:[]};c&&c.length&&(b.each(c,function(h,g){var f=g.getAsFile&&g.getAsFile();f&&e.files.push(f)}),this._trigger("paste",b.Event("paste",{delegatedEvent:d}),e)!==!1&&this._onAdd(d,e))},_onDrop:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var c=this,e=d.dataTransfer,f={};e&&e.files&&e.files.length&&(d.preventDefault(),this._getDroppedFiles(e).always(function(g){f.files=g,c._trigger("drop",b.Event("drop",{delegatedEvent:d}),f)!==!1&&c._onAdd(d,f)}))},_onDragOver:a("dragover"),_onDragEnter:a("dragenter"),_onDragLeave:a("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),b.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(d,c){var e=-1!==b.inArray(d,this._specialOptions);e&&this._destroyEventHandlers(),this._super(d,c),e&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var c=this.options;void 0===c.fileInput?c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):c.fileInput instanceof b||(c.fileInput=b(c.fileInput)),c.dropZone instanceof b||(c.dropZone=b(c.dropZone)),c.pasteZone instanceof b||(c.pasteZone=b(c.pasteZone))},_getRegExp:function(f){var d=f.split("/"),c=d.pop();return d.shift(),new RegExp(d.join("/"),c)},_isRegExpOption:function(d,c){return"url"!==d&&"string"===b.type(c)&&/^\/.*\/[igm]{0,3}$/.test(c)},_initDataAttributes:function(){var d=this,c=this.options,e=this.element.data();b.each(this.element[0].attributes,function(g,i){var h,f=i.name.toLowerCase();/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(j){return j.charAt(1).toUpperCase()}),h=e[f],d._isRegExpOption(f,h)&&(h=d._getRegExp(h)),c[f]=h)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(d){var c=this;d&&!this.options.disabled&&(d.fileInput&&!d.files?this._getFileInputFiles(d.fileInput).always(function(f){d.files=f,c._onAdd(null,d)}):(d.files=b.makeArray(d.files),this._onAdd(null,d)))},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var c,f,h=this,g=b.Deferred(),e=g.promise();return e.abort=function(){return f=!0,c?c.abort():(g.reject(null,"abort","abort"),e)},this._getFileInputFiles(d.fileInput).always(function(i){if(!f){if(!i.length){return void g.reject()}d.files=i,c=h._onSend(null,d),c.then(function(l,k,j){g.resolve(l,k,j)},function(l,k,j){g.reject(l,k,j)})}}),this._enhancePromise(e)}if(d.files=b.makeArray(d.files),d.files.length){return this._onSend(null,d)}}return this._getXHRPromise(!1,d&&d.context)}})});