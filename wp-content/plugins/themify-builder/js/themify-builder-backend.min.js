(function(b){if(b("#page-builder.themify_write_panel").length===0){return}var a=themifybuilderapp;a.mode="skeleton";a.isPostSave=false;a.render=function(){var c=new a.Collections.Rows(themifyBuilder.builder_data);a.Instances.Builder[0]=new a.Views.Builder({el:"#themify_builder_row_wrapper",collection:c});a.Instances.Builder[0].render();this.toolbar=new a.Views.Toolbar({el:"#tb_toolbar"});b("input#publish,input#save-post").on("click",function(f){if(f.which){b('input[name*="builder_switch_frontend"]').val(0)}if(!a.isPostSave){a.Utils.saveBuilder(false).done(function(){ThemifyBuilderCommon.undoManager.instance.clear();a.isPostSave=true;b(f.currentTarget).trigger("click")});f.preventDefault()}});b("#themify_builder_switch_frontend").on("click",this.switchFrontEnd);b('<a href="#" id="themify_builder_switch_frontend_button" class="button themify_builder_switch_frontend">'+themifyBuilder.i18n.switchToFrontendLabel+"</a>").on("click",this.switchFrontEnd).appendTo("#postdivrich #wp-content-media-buttons");if(window.sessionStorage.getItem("frontendURL")){var d=window.sessionStorage.getItem("frontendURL");window.sessionStorage.removeItem("frontendURL");ThemifyBuilderCommon.showLoader("show");window.location.href=d}b('input[name*="builder_switch_frontend"]').closest(".themify_field_row").hide();a.Views.bindEvents();a.Forms.bindEvents()};a.switchFrontEnd=function(d){d.preventDefault();var c=themifyBuilder.permalink.replace(/\&amp;/g,"&")+"#builder_active";if(b("#themify_builder_row_wrapper").is(":visible")){a.Utils.saveBuilder(true,function(){ThemifyBuilderCommon.undoManager.instance.clear();a.createPostBuilderButton(c)})}else{a.createPostBuilderButton(c)}};a.createPostBuilderButton=function(d){var c=b("#post_ID").val();if(window.location.href.indexOf(c)<0){window.sessionStorage.setItem("frontendURL",d);b("#post").trigger("submit")}else{window.location.href=d}};b(function(){var c;a.render();if(typeof window.icl_copy_from_original=="function"){c=window.icl_copy_from_original;window.icl_copy_from_original=function(d,e){c(d,e);jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"themify_builder_icl_copy_from_original",source_page_id:e,source_page_lang:d},success:function(f){if(f!="-1"){jQuery("#page-builder .themify_builder.themify_builder_admin").empty().append(f).contents().unwrap()}}})}}});b(window).load(function(){var l=b("#tb_toolbar"),i=b("#themify_builder_module_tmp"),g=b("#tb_scroll_anchor"),e=0,h=null,d=0,c=b("#wpadminbar"),j=c.outerHeight(true);if(l.length>0){if(l.is(":visible")){k()}else{b(".themify-meta-box-tabs a").one("click",function(){if(b(this).attr("id")=="page-buildert"){k()}})}}function k(){l.width(l.width());e=g.offset().top;d=Math.round(b("#page-builder").offset().top);i.height(l.outerHeight(true));b(window).scroll(function(){if(h){clearTimeout(h)}h=setTimeout(f,15)}).resize(function(){e=g.offset().top;l.width(b("#page-builder .themify_builder_admin").width()).css("top",c.outerHeight(true));i.height(l.outerHeight(true))})}function f(){h=null;var n=d+b("#page-builder").height(),m=b(this).scrollTop();if(m>e&&m<n){l.addClass("tb_toolbar_fixed").css("top",j);i.css("display","block")}else{l.removeClass("tb_toolbar_fixed").css("top",0);i.css("display","none")}}})})(jQuery);