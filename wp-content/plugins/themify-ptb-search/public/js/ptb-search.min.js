(function(e){var i=function(k,m){var l=k.length-1;e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"ptb_search_set_values",data:k[m]},success:function(u){var t=e(e("form.ptb-search-form")[m]);for(var s in u){if(u[s].min){var p=Math.floor(u[s].min),n=Math.floor(u[s].max),r=e("#"+s+"_min"),o=e("#"+s+"_max");if(!r.val()){r.val(p)}if(!o.val()){o.val(n)}r.attr("min",p);o.prop("max",n)}else{for(var q in u[s]){e("#"+s+"_"+u[s][q]).prop("disabled",true);e("#"+s+"_"+u[s][q]).closest("div").addClass("ptb-search-disabled")}}}a(t);if(l>m){++m;i(k,m)}}})};var h=function(){if(e.fn.chosen){e("form.ptb-search-form").find("select").chosen({disable_search_threshold:7,search_contains:true,width:"100%"})}};var a=function(k){if(e.fn.slider){k.find(".ptb-search-slider").each(function(){var l=e(this).closest(".ptb_search_wrap_number"),m=l.find(".ptb_search_number_max"),p=l.find(".ptb_search_number_min"),n=parseInt(p.prop("min")),o=parseInt(m.prop("max")),r=parseInt(p.val()),q=parseInt(m.val());if(n&&o){e(this).slider({range:true,min:n,step:1,max:o,values:[r,q],slide:function(s,t){p.val(t.values[0]);m.val(t.values[1]);var u=e(this).find(".ptb-search-slider-tooltip-inner");u.first().html(t.values[0]);u.last().html(t.values[1])},create:function(s,u){var t='<span class="ptb-search-slider-tooltip"><span class="ptb-search-slider-tooltip-inner">'+r+'</span><span class="ptb-search-slider-tooltip-arrow"></span></span>',v=e(this).children(".ui-slider-handle");v.first().html(t);v.last().html(t.replace(r,q))}})}})}};var j=function(){e(".ptb-search-autocomplete").each(function(){var m=e(this),l=m.data("post_type"),k=[];k[l]=[];m.autocomplete({minLength:2,source:function(p,n){var o=e.trim(p.term);if(o.length<2){return}o=o.toLowerCase();if(o in k[l]){n(k[l][o]);return}p.action="ptb_search_autocomplete";p.key=m.data("key");e.getJSON(ajaxurl,p,function(r,q,s){k[l][o]=r;n(r)})},select:function(n,o){m.val(o.item.value);m.next("input").val(o.item.id);return false}}).focus(function(){e(this).autocomplete("search")}).autocomplete("widget").addClass("ptb-search-autocomplete-dropdown")})};var f=function(){e("body").delegate(".ptb-search-form:not(.ptb-search-form-submit)","submit",function(m){m.preventDefault();var k=e(this),n=e(".ptb-search-container").first(),l=k.serialize();if(n.length===0){n=e(".post").first()}k.find('input[name="p"]').val("");e.ajax({url:k.attr("action"),data:l,type:"POST",beforeSend:function(){k.addClass("ptb-search-submit");n.addClass("ptb-search-wait")},complete:function(){k.removeClass("ptb-search-submit");n.removeClass("ptb-search-wait")},success:function(o){if(o){n.html(o);d(n);history.replaceState({},null,"?"+l);if(typeof window.wp.mediaelement!="undefined"){window.wp.mediaelement.initialize()}e.event.trigger({type:"ptb_loaded"})}}})})};function b(l){var k=parseInt(l.text());if(!k){k=parseInt(l.closest(".ptb_pagenav").find(".current").text());if(l.hasClass("next")){++k}else{--k}}return k}var g=function(){e("body").delegate(".ptb-search-container .ptb_pagenav a","click",function(l){var m=e(this).closest(".ptb-search-container").data("slug"),k=e(".ptb-search-"+m);if(k.length>0){l.preventDefault();k.find('input[name="ptb_page"]').val(b(e(this)));k.submit()}})};var d=function(k){if(k.length>0){e("html,body").animate({scrollTop:k.offset().top-e("#wpadminbar").outerHeight(true)-10},1000)}};var c=function(){if(e.timepicker){var l=e(".ptb_search_field_date input");var k={showOn:"focus",showButtonPanel:true,showHour:1,showMinute:1,timeOnly:false,showTimepicker:false,buttonText:false,dateFormat:"yy-mm-dd",timeFormat:"hh:mm tt",stepMinute:5,separator:"@",minInterval:0,beforeShow:function(){e("#ui-datepicker-div").addClass("ptb_search_datepicker")},onClose:function(n,m){}};l.each(function(){var n=e(this).data("id");if(n){var m=e("#"+n+"_end");if(e(this).data("time")){k.showTimepicker=1}e.timepicker.datetimeRange(e(this),m,k)}})}};e(document).ready(function(){h();j();var k=[];e("form.ptb-search-form").each(function(l){k[l]=e(this).find(".ptb_search_keys").val()});if(("ontouchstart" in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0)){PTB.LoadAsync(ptb_search.url+"js/jquery.ui.touch-punch.min.js",function(){c();i(k,0)},null,ptb_search.ver)}else{i(k,0);c()}f();g()})}(jQuery));